version: 2.0

test:
    image:
        daocloud/ci-golang:1.6

    services:
        - cms

    # using default docker-link env
    env:
        - REDIS_PORT_6379_TCP_PROTO = "tcp"
        - REDIS_PASSWORD = ""

    install:
        - sudo apt-get update

    before_script:
        - mkdir -p /gopath/src/gocms
        - mv ./* /gopath/src/gocms

    script:
        - export GOPATH=/gopath
        - go get -t gocmd
        - go test gocms

build:
    image:
        dockerfile_path: Dockerfile
        build_dir: /
        cache: true